$folderPath = "C:\QVDs"
$files = Get-ChildItem $folderPath -Filter *.qvd

foreach ($file in $files) {
    $xmlDoc = New-Object System.Xml.XmlDocument
    $xmlReader = New-Object System.Xml.XmlTextReader($file.FullName)
    $xmlReader.Namespaces = $false

    # Move to the QvdTableHeader node
    while ($xmlReader.Read()) {
        if ($xmlReader.NodeType -eq "Element" -and $xmlReader.Name -eq "QvdTableHeader") {
            break
        }
    }

    # Load only the QvdTableHeader node
    $qvdHeader = $xmlDoc.ReadNode($xmlReader)

    # Get the NoOfRecords property value
    $noOfRecords = [int]$qvdHeader.SelectSingleNode("//NoOfRecords").InnerText

    # If NoOfRecords is 0, delete the file
    if ($noOfRecords -eq 0) {
        Remove-Item $file.FullName
        Write-Host "Deleted $($file.Name) because it has 0 records."
    }
}

Write-Host "Done."
