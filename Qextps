# Define the extension name and file path
$extensionName = "MyTableExtension"
$extensionPath = "C:\QlikSense\Extensions\$extensionName"

# Create the extension folder
New-Item -ItemType Directory -Path $extensionPath | Out-Null

# Create the script file
$scriptFilePath = "$extensionPath\script.js"
$scriptContent = @"
define(["jquery", "qlik"], function($, qlik) {
  'use strict';

  var myTableExtension = {
    initialProperties: {
      version: 1.0,
      qHyperCubeDef: {
        qDimensions: [],
        qMeasures: [],
        qInitialDataFetch: [
          {
            qWidth: 10,
            qHeight: 1000
          }
        ]
      }
    },
    definition: {
      type: 'items',
      component: 'accordion',
      items: {
        dimensions: {
          uses: 'dimensions',
          min: 1,
          max: 5
        },
        measures: {
          uses: 'measures',
          min: 1,
          max: 5
        },
        sorting: {
          uses: 'sorting'
        },
        appearance: {
          uses: 'settings'
        }
      }
    },
    paint: function($element, layout) {
      var html = "<table style='width:100%'>";

      // Add table header
      html += "<thead><tr>";
      layout.qHyperCube.qDimensionInfo.forEach(function(dimInfo) {
        html += "<th>" + dimInfo.qFallbackTitle + "</th>";
      });
      layout.qHyperCube.qMeasureInfo.forEach(function(measureInfo) {
        html += "<th>" + measureInfo.qFallbackTitle + "</th>";
      });
      html += "</tr></thead>";

      // Add table rows
      html += "<tbody>";
      layout.qHyperCube.qDataPages[0].qMatrix.forEach(function(row) {
        html += "<tr>";
        row.forEach(function(cell) {
          html += "<td>" + cell.qText + "</td>";
        });
        html += "</tr>";
      });
      html += "</tbody></table>";

      // Set the extension's HTML content
      $element.html(html);
    }
  };

  return myTableExtension;
});
"@
$scriptContent | Out-File -FilePath $scriptFilePath -Encoding UTF8

# Create the style file
$styleFilePath = "$extensionPath\style.css"
$styleContent = @"
table {
  border-collapse: collapse;
}

th, td {
  border: 1px solid black;
  padding: 8px;
}

th {
  background-color: #f2f2f2;
}
"@
$styleContent | Out-File -FilePath $styleFilePath -Encoding UTF8

# Create the definition file
$definitionFilePath = "$extensionPath\definition.qext"
$definitionContent = @"
{
  "name": "$extensionName",
  "type": "visualization",
  "description": "Table-like extension",
  "author": "Your Name",
  "version": "1.0.0",
  "icon": "",
  "preview": "",
  "keywords": [],
  "homepage": "",
  "dependencies": [],
  "license": "",
  "repository": "",
  "thumbnail": "",
  "repositoryType": "git",
  "downloadUrl": ""
}
"@
$definitionContent | Out-File -FilePath $definitionFilePath -Encoding UTF8

# Create the HTML file
$htmlFilePath = "$extensionPath\template.html"
$htmlContent = @"
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>$extensionName</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
  <div id="container">
    <div id="table-container"></div>
  </div>

  <script src="/resources/assets/external/requirejs/require.js"></script>
  <script>
    require.config({
      baseUrl: "/resources",
      paths: {
        "jquery": "/resources/assets/external/jquery/jquery",
        "qlik": "/resources/js/qlik"
      }
    });

    require(["jquery", "qlik"], function($, qlik) {
      $(function() {
        qlik.setOnError(function(error) {
          console.log(error);
        });

        qlik.setOnAbort(function() {
          console.log("Extension aborted.");
        });

        qlik.getGlobal().getAuthenticatedUser(function(reply) {
          console.log("Authenticated user: " + reply.qMsg);
        });

        qlik.currApp(function(app) {
          app.visualization.create("myTableExtension", [], {}).then(function(vis) {
            vis.show("table-container");
          });
        });
      });
    });
  </script>
</body>
</html>
"@
$htmlContent | Out-File -FilePath $htmlFilePath -Encoding UTF8

# Inform the user about the extension creation
Write-Host "Qlik Sense extension '$extensionName' has been created successfully at: $extensionPath"
