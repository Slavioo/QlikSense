# Define the extension name and file path
$extensionName = "MyTableExtension"
$extensionPath = "C:\QlikSense\Extensions\$extensionName"

# Create the extension folder
New-Item -ItemType Directory -Path $extensionPath | Out-Null

# Create the script file
$scriptFilePath = "$extensionPath\script.js"
$scriptContent = @"
define([], function() {
  'use strict';

  var myTableExtension = {
    definition: {
      type: 'items',
      component: 'accordion',
      items: {
        dimensions: {
          uses: 'dimensions',
          min: 1,
          max: 5
        },
        measures: {
          uses: 'measures',
          min: 1,
          max: 5
        },
        sorting: {
          uses: 'sorting'
        },
        appearance: {
          uses: 'settings'
        }
      }
    },
    paint: function($element, layout) {
      var html = "<table style='width:100%'>";

      // Add table header
      html += "<thead><tr>";
      layout.qHyperCube.qDimensionInfo.forEach(function(dimInfo) {
        html += "<th>" + dimInfo.qFallbackTitle + "</th>";
      });
      layout.qHyperCube.qMeasureInfo.forEach(function(measureInfo) {
        html += "<th>" + measureInfo.qFallbackTitle + "</th>";
      });
      html += "</tr></thead>";

      // Add table rows
      html += "<tbody>";
      layout.qHyperCube.qDataPages[0].qMatrix.forEach(function(row) {
        html += "<tr>";
        row.forEach(function(cell) {
          html += "<td>" + cell.qText + "</td>";
        });
        html += "</tr>";
      });
      html += "</tbody></table>";

      // Set the extension's HTML content
      $element.html(html);
    }
  };

  return myTableExtension;
});
"@
$scriptContent | Out-File -FilePath $scriptFilePath -Encoding UTF8

# Create the definition file
$definitionFilePath = "$extensionPath\definition.xml"
$definitionContent = @"
<?xml version="1.0" encoding="utf-8"?>
<ExtensionObject Label="$extensionName" Type="visualization">
  <Script src="script.js"/>
  <Properties/>
  <InitialDataFetch>0</InitialDataFetch>
  <Appearance>
    <Dimensions>
      <DimensionGroup Label="Dimensions">
        <Type>StringExpression</Type>
        <Expression>false</Expression>
      </DimensionGroup>
    </Dimensions>
    <Measures>
      <MeasureGroup Label="Measures">
        <Type>Number</Type>
        <Expression>false</Expression>
      </MeasureGroup>
    </Measures>
    <Sorting>
      <Array/>
    </Sorting>
  </Appearance>
  <Layout>
    <Settings/>
  </Layout>
  <Meta>
    <Fields/>
  </Meta>
</ExtensionObject>
"@
$definitionContent | Out-File -FilePath $definitionFilePath -Encoding UTF8

# Inform the user about the extension creation
Write-Host "Qlik Sense extension '$extensionName' has been created successfully at: $extensionPath"
