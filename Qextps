# Define the extension name and file path
$extensionName = "MyStraightTableExtension"
$extensionPath = "C:\QlikSense\Extensions\$extensionName"

# Create the extension folder
New-Item -ItemType Directory -Path $extensionPath | Out-Null

# Create the script file
$scriptFilePath = "$extensionPath\script.js"
$scriptContent = @'
define([], function() {
  'use strict';

  return {
    definition: {
      type: "items",
      component: "accordion",
      items: {
        dimensions: {
          uses: "dimensions",
          min: 1,
          max: 3
        },
        measures: {
          uses: "measures",
          min: 1,
          max: 5
        }
      }
    },
    paint: function($element, layout) {
      var html = "<table class=\"qlik-table\">";

      // Add table header
      html += "<thead><tr>";
      layout.qHyperCube.qDimensionInfo.forEach(function(dimInfo) {
        html += "<th>" + dimInfo.qFallbackTitle + "</th>";
      });
      layout.qHyperCube.qMeasureInfo.forEach(function(measureInfo) {
        html += "<th>" + measureInfo.qFallbackTitle + "</th>";
      });
      html += "</tr></thead>";

      // Add table rows
      html += "<tbody>";
      layout.qHyperCube.qDataPages[0].qMatrix.forEach(function(row) {
        html += "<tr>";
        row.forEach(function(cell) {
          html += "<td>" + cell.qText + "</td>";
        });
        html += "</tr>";
      });
      html += "</tbody></table>";

      // Set the extension's HTML content
      $element.html(html);
    }
  };
});
'@
$scriptContent | Out-File -FilePath $scriptFilePath -Encoding UTF8

# Create the CSS file
$cssFilePath = "$extensionPath\style.css"
$cssContent = @'
.qlik-table {
  font-family: Arial, sans-serif;
  width: 100%;
  border-collapse: collapse;
}

.qlik-table th {
  background-color: #f2f2f2;
  border: 1px solid #ddd;
  padding: 8px;
  text-align: left;
}

.qlik-table td {
  border: 1px solid #ddd;
  padding: 8px;
}

.qlik-table tr:nth-child(even) {
  background-color: #f9f9f9;
}

.qlik-table tr:hover {
  background-color: #e8f5ff;
}

.qlik-table thead th {
  font-weight: bold;
}

.qlik-table tfoot td {
  font-weight: bold;
  border-top: 1px solid #ddd;
}
'@
$cssContent | Out-File -FilePath $cssFilePath -Encoding UTF8

# Create the HTML template file
$templateFilePath = "$extensionPath\template.html"
$templateContent = @'
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Qlik Sense Extension</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  <script type="text/javascript" src="script.js"></script>
</head>
<body>
  <div id="container" class="qv-object-MyStraightTableExtension"></div>
</body>
</html>
'@
$templateContent | Out-File -FilePath $templateFilePath -Encoding UTF8

# Create the definition file
$definitionFilePath = "$extensionPath\definition.qext"
$definitionContent = @'
{
  "name": "' + $extensionName + '",
  "type": "visualization",
  "description": "Straight Table Extension",
  "author": "Your Name",
  "version": "1.0.0",
  "icon": "extension-icon.png",
  "preview": "extension-preview.png",
  "keywords": [],
  "dependencies": { "qlik-sense": ">=1.0.0" },
  "template": "template.html",
  "authoringMeta": {
    "offCanvas": true,
    "noSelections": true,
    "suppressInternal": false
  }
}
'@
$definitionContent | Out-File -FilePath $definitionFilePath -Encoding UTF8

# Inform the user about the extension creation
Write-Host "Qlik Sense extension '$extensionName' has been created successfully at: $extensionPath"
