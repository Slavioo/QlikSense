define(["qlik", "jquery"], function(qlik, $) {
    return {
        paint: function($element, layout) {
            var app = qlik.currApp(this);
            var $button = $('<button>Export Data</button>');
            $button.on('click', function() {
                app.visualization.get('dhPseQ').then(function(vis) {
                    vis.exportData().then(function(data) {
                        var csvFile = new Blob([data], {type: "text/csv"});
                        var downloadLink = document.createElement("a");
                        downloadLink.download = 'data.csv';
                        downloadLink.href = window.URL.createObjectURL(csvFile);
                        downloadLink.style.display = "none";
                        document.body.appendChild(downloadLink);
                        downloadLink.click();
                    });
                });
            });
            $element.empty();
            $element.append($button);
        }
    };
});
